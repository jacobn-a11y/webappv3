# Database (matches docker-compose.yml defaults)
DATABASE_URL="postgresql://storyengine:storyengine_dev@localhost:5432/storyengine"

# Redis (BullMQ job queue)
REDIS_URL="redis://localhost:6379"

# ─── Merge.dev (Unified API — OPTIONAL, disabled by default) ────────────────
# Merge.dev is only used when an IntegrationConfig with provider=MERGE_DEV
# is created and enabled for an org. For the pilot, use direct integrations
# (Grain, Gong, SFDC) instead. Re-enable Merge.dev later for multi-provider use.
MERGE_API_KEY=""
MERGE_ACCOUNT_TOKEN=""                    # Legacy: per-linked-account tokens are now stored in the database
MERGE_WEBHOOK_SECRET=""

# ─── Direct Integrations ────────────────────────────────────────────────────
# Credentials for Grain, Gong, and Salesforce are stored per-organization in
# the IntegrationConfig database table (not as env vars). Configure them via:
#   POST /api/integrations { provider: "GONG", credentials: { accessKey: "...", accessKeySecret: "..." } }
#   POST /api/integrations { provider: "GRAIN", credentials: { apiToken: "..." } }
#   POST /api/integrations { provider: "SALESFORCE", credentials: { instanceUrl: "...", ... } }
#
# Then validate with: POST /api/integrations/:provider/test
# And trigger initial sync: POST /api/integrations/:provider/sync

# Integration sync interval (how often to poll Grain/Gong/SFDC for new data)
SYNC_INTERVAL_MINUTES=15

# ─── AI / LLM ──────────────────────────────────────────────────────────────
# OpenAI (LLM for tagging, summarization, embeddings)
# Still required for Pinecone embeddings even when using other AI providers
OPENAI_API_KEY=""

# OpenAI Rate Limiting (defaults match gpt-4o Tier 1)
OPENAI_MAX_RPM=500         # max requests per minute
OPENAI_MAX_TPM=30000       # max tokens per minute

# AI Tagger
TAGGER_CONCURRENCY=5       # max concurrent LLM requests per job
TAG_CACHE_MAX_SIZE=10000   # max entries in the in-memory tag cache
TAG_CACHE_TTL_MS=3600000   # cache TTL in ms (default: 1 hour)

# AI Configuration
# Secret key for encrypting AI provider API keys at rest (AES-256-GCM)
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
AI_KEY_ENCRYPTION_SECRET=""

# Pinecone (Vector DB for transcript embeddings)
PINECONE_API_KEY=""
PINECONE_INDEX="storyengine-transcripts"

# ─── Auth ───────────────────────────────────────────────────────────────────
# WorkOS (Auth - Google SSO + Email)
WORKOS_API_KEY=""
WORKOS_CLIENT_ID=""
WORKOS_REDIRECT_URI="http://localhost:5173/auth/callback"

# Platform Admin
# API key for the platform owner dashboard (/api/platform/* routes)
# Set to a strong random value in production
PLATFORM_ADMIN_API_KEY=""

# ─── Billing ────────────────────────────────────────────────────────────────
# Stripe (Billing — all optional, commercialization is off by default)
BILLING_ENABLED="true"             # self-service default; set to "false" only for internal dev bypass
STRIPE_SECRET_KEY=""
STRIPE_WEBHOOK_SECRET=""
STRIPE_STARTER_PRICE_ID=""        # Metered price: $0.05/transcript minute
STRIPE_PROFESSIONAL_PRICE_ID=""   # Metered price: $0.03/transcript minute
STRIPE_ENTERPRISE_PRICE_ID=""     # Custom metered price (optional — omit to route to sales)
STRIPE_METERED_PRICE_ID=""        # Stripe price ID for usage-based (per transcript-minute) billing
STRIPE_SEAT_PRICE_ID=""           # Stripe price ID for per-seat billing

# Pricing Configuration (optional — only needed when billing is enabled per-org)
TRIAL_DAYS="14"                   # Free trial duration in days
DEFAULT_SEAT_LIMIT=""             # Default seat limit for new seat-based plans (blank = unlimited)
INCLUDED_MINUTES=""               # Included transcript minutes per period before overages

# ─── Exports ────────────────────────────────────────────────────────────────
# Puppeteer (PDF Export)
PUPPETEER_EXECUTABLE_PATH="/usr/bin/chromium-browser"

# Google (Google Doc Export — OAuth handled per-request via access_token)
GOOGLE_DRIVE_FOLDER_ID=""         # optional: move exported docs to this Drive folder

# Slack (Send to Slack)
SLACK_WEBHOOK_URL=""              # default incoming webhook URL; can also be passed per-request

# ─── Email ──────────────────────────────────────────────────────────────────
# Resend (Email — weekly story digest)
RESEND_API_KEY=""
STORY_REGEN_FROM_EMAIL="StoryEngine <noreply@storyengine.io>"
INVITE_FROM_EMAIL="StoryEngine <noreply@storyengine.io>"

# ─── App ────────────────────────────────────────────────────────────────────
PORT=3000
NODE_ENV="development"
DEPLOY_ENV="development"         # development | staging | production
APP_URL="http://localhost:3000"
FRONTEND_URL="http://localhost:5173"  # used for checkout/invite/auth redirects

# Environment-level feature flag overrides (JSON):
# Example: {"staging":{"new_dashboard":true},"production":{"new_dashboard":false}}
FEATURE_FLAG_ENV_OVERRIDES_JSON=""

# Org-level feature flag overrides (JSON):
# Example: {"org_123":{"new_dashboard":true}}
FEATURE_FLAG_ORG_OVERRIDES_JSON=""

# Environment-level entitlement overrides (JSON):
# Example: {"staging":{"feature_flags":["premium_export"],"usage_caps":{"stories_per_month":5000}}}
ENTITLEMENT_ENV_OVERRIDES_JSON=""

# Org-level entitlement overrides (JSON):
# Example: {"org_123":{"seat_limit":200,"feature_flags":["premium_export"]}}
ENTITLEMENT_ORG_OVERRIDES_JSON=""
